---
title: "[2026 동계 모각코] 2026-01-02 결과 (1회차)"
image: "/images/mogakco_1.png"
date: "2026-01-02"
category: "mogakco"
tags: ["모각코"]
summary: ""
draft: false
---

## 목표
- 목표: 데이터 소스(History/Downloads) 구조 파악
- 진행 내용
    - Chrome/Edge DB 파일 경로 정리 (OS별/프로필별)
    - History DB에서 downloads 관련 테이블/컬럼 확인

## 진행 내용

### Chrome/Edge DB 파일 경로 정리 (OS별/프로필별)

Chrome과 Edge는 동일한 Chromium 엔진을 사용하므로 DB 구조가 거의 동일하다. 사용자의 브라우저 데이터는 프로필별로 분리되어 저장된다.

#### Windows
| 브라우저 | 경로 |
|---------|------|
| Chrome | `%LOCALAPPDATA%\Google\Chrome\User Data\<Profile>\History` |
| Edge | `%LOCALAPPDATA%\Microsoft\Edge\User Data\<Profile>\History` |

#### macOS
| 브라우저 | 경로 |
|---------|------|
| Chrome | `~/Library/Application Support/Google/Chrome/<Profile>/History` |
| Edge | `~/Library/Application Support/Microsoft Edge/<Profile>/History` |

#### Linux
| 브라우저 | 경로 |
|---------|------|
| Chrome | `~/.config/google-chrome/<Profile>/History` |
| Edge | `~/.config/microsoft-edge/<Profile>/History` |

> `<Profile>`은 기본값이 `Default`이며, 추가 프로필은 `Profile 1`, `Profile 2` 등으로 생성된다.

![Chrome User Data 폴더 내 Default 프로필과 History 파일](/images/mogakco_1.png)

### History DB에서 downloads 관련 테이블/컬럼 확인

> 이하 내용은 **Windows 환경**을 기준으로 작성되었다.

History 파일은 SQLite 형식의 데이터베이스이다. DB Browser for SQLite를 사용하여 테이블 구조를 확인했다.

![DB Browser for SQLite에서 History 파일의 테이블 목록](/images/mogakco_2.png)

#### 주요 테이블

| 테이블명 | 설명 |
|---------|------|
| `downloads` | 다운로드 기록의 핵심 정보 |
| `downloads_url_chains` | 다운로드 URL 리다이렉션 체인 |
| `downloads_slices` | 다운로드 청크/세그먼트 정보 |

#### downloads 테이블 주요 컬럼

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| `id` | INTEGER | 다운로드 고유 ID (PK) |
| `current_path` | VARCHAR | 현재 저장된 파일의 전체 경로 |
| `target_path` | VARCHAR | 다운로드 완료 시 저장될 경로 |
| `start_time` | INTEGER | 다운로드 시작 시간 (WebKit timestamp) |
| `end_time` | INTEGER | 다운로드 완료 시간 (WebKit timestamp) |
| `received_bytes` | INTEGER | 수신된 바이트 수 |
| `total_bytes` | INTEGER | 전체 파일 크기 |
| `state` | INTEGER | 다운로드 상태 (0: 진행중, 1: 완료, 2: 취소, 3: 인터럽트) |
| `danger_type` | INTEGER | 위험 유형 (0: 안전, 1~: 위험 유형별 코드) |
| `interrupt_reason` | INTEGER | 중단 사유 코드 |
| `mime_type` | VARCHAR | 파일의 MIME 타입 |
| `original_mime_type` | VARCHAR | 서버가 전달한 원본 MIME 타입 |
| `referrer` | VARCHAR | 다운로드를 시작한 페이지 URL |
| `tab_url` | VARCHAR | 다운로드 당시 탭의 URL |
| `tab_referrer_url` | VARCHAR | 탭의 referrer URL |
| `opened` | INTEGER | 다운로드 후 파일 열림 여부 (0/1) |
| `by_ext_id` | VARCHAR | 다운로드를 시작한 확장프로그램 ID |
| `by_ext_name` | VARCHAR | 다운로드를 시작한 확장프로그램 이름 |

![DB Browser에서 downloads 테이블의 스키마 정보](/images/mogakco_3.png)

#### downloads_url_chains 테이블

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| `id` | INTEGER | downloads 테이블의 id 참조 (FK) |
| `chain_index` | INTEGER | URL 체인 순서 (0부터 시작) |
| `url` | VARCHAR | 리다이렉션 체인의 각 URL |

> 단축 URL이나 리다이렉션이 포함된 다운로드의 경우, 최초 URL부터 최종 URL까지의 전체 경로를 추적할 수 있다.

#### WebKit Timestamp 변환

Chrome/Edge의 시간 정보는 WebKit timestamp를 사용한다. 이는 **1601년 1월 1일**을 기준으로 한 마이크로초 단위 값이다.

아래는 downloads 테이블에서 확인한 WebKit timestamp 원본 값이다.

![downloads 테이블의 WebKit timestamp 원본 데이터](/images/mogakco_4.png)

[Epoch Converter](https://www.epochconverter.com/webkit)를 사용하면 다음과 같이 사람이 읽을 수 있는 형태로 변환할 수 있다.

![WebKit timestamp 변환 결과](/images/mogakco_5.png)

#### 샘플 데이터 확인

실제 History DB에서 다운로드 기록을 조회하는 쿼리:

```sql
SELECT
    d.id,
    d.target_path,
    datetime(d.start_time/1000000 - 11644473600, 'unixepoch', 'localtime') as start_time,
    d.total_bytes,
    d.state,
    d.mime_type,
    d.referrer,
    duc.url as download_url
FROM downloads d
LEFT JOIN downloads_url_chains duc ON d.id = duc.id AND duc.chain_index = 0
ORDER BY d.start_time DESC
LIMIT 10;
```

## 회고

- Chrome과 Edge가 동일한 Chromium 기반이라 DB 구조가 거의 같아서 하나의 파서로 두 브라우저를 모두 처리할 수 있을 것 같다.
- WebKit timestamp 변환 로직을 미리 구현해두면 이후 리포트 생성 시 유용할 것이다.
- `danger_type` 컬럼을 활용하면 4회차에서 진행할 위험 신호 탐지에 도움이 될 것으로 보인다.
- 다음 회차에서는 이 컬럼들 중 실제로 추출할 필드와 정규화 규칙을 확정해야 한다.
